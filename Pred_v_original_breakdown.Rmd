---
title: "Predicted vs Original Breakdown"
output: html_notebook
---

## Comparing actual vs predicted

Here is where it gets interesting and we get an answer to our question. I've checked out the results of the different algorithms and I've picked out the model generated by the Multivariate adaptive regression spline (MARS). 

I then use that model to *predict* the whitespace preference and then redo our original "Tabs versus Spaces salaries" boxplot side-by-side with the predicted whitespace preference.

```{r}

final_model <- space_pref_working_emc %>% filter(algorithm == "glmnet") %>% pull(train) %>% first()
survey_augment_df <- survey_df
survey_augment_df$Model <- "glmnet"
survey_augment_df$Original.Whitespace <- survey_augment_df$Whitespace
survey_augment_df$Whitespace <-  predict(final_model, space_pref_df)
survey_augment_df$Space.Probability <- predict(final_model, space_pref_df, type="probs")$Spaces
survey_augment_df$Space.Odds <- survey_augment_df$Space.Probability / (1 - survey_augment_df$Space.Probability)
survey_augment_df$Space.Logodds <- log(survey_augment_df$Space.Odds)

survey_combined_df <- survey_df
survey_combined_df$Model <- "Original"
survey_combined_df <- bind_rows(survey_combined_df, survey_augment_df)

```

```{r}
survey_combined_dfs <- survey_combined_df %>% group_by(Whitespace, Model) %>% summarise(median = median(Salary), medianLabel = dollarFormat(median))
survey_combined_df %>%
    ggplot(aes(x = Whitespace, y = Salary)) +
    geom_boxplot(aes(fill = Whitespace)) +
    geom_text(data = survey_combined_dfs, aes(x = Whitespace, y = median, label = medianLabel), size = 3, vjust = -1.5) +
    scale_y_continuous(name = "Salary", labels = dollarFormat) +
    xlab("Indentation preference") +
    guides(fill = FALSE) +
	theme_minimal() + 
    facet_wrap(~ Model)
```

Both the original and the prediced plots are pretty much the same.

We keep with this theme and repeat the country breakdown side-by-side with the predicted version.

```{r}
country_combined_respondants <- survey_combined_df %>% group_by(Country, Model) %>% summarise(n_respondants = n())  %>% arrange(desc(n_respondants))
survey_combined_df %>%
    filter(Country %in% top10_countries) %>%
    ggplot() +
    geom_boxplot(aes(x = Country, y = Standard.Salary, fill = Whitespace)) +
    scale_y_continuous(name = "Standard Salary", labels = dollarFormat) +
    xlab("Country") +
    coord_flip() +
    theme_minimal() +
	ggtitle("Tabs vs spaces countries - original versus predicted") +
    facet_wrap(~ Model)

```

Other than Spain the country breakdown is pretty much the same.

Finally lets repeat the experience break-down.

```{r}
survey_combined_df %>%
    ggplot() +
    geom_boxplot(aes(x =  Years.Program, y = Standard.Salary, fill = Whitespace)) +
    scale_y_continuous(name = "Standard Salary", labels = dollarFormat) +
    xlab("Years Experience") +
    coord_flip() +
    theme_minimal() +
	ggtitle("Tabs vs spaces standard salaries by experience") +
    facet_wrap(~ Model)

```

The pattern of the previous plots continues. A few minor differences but mostly the same. It looks like our predictive model is doing a good job of reconstructing that persistent pattern of developers who prefer to format their code with spaces earning more than those who use tabs.

